<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pase Digital</title>
  <style>
    body { font-family: Helvetica, sans-serif; background: #f0f4f8; padding: 20px; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
    li { margin: 5px 0; }
    #estado { margin-top: 15px; font-weight: bold; font-size: 1.2em; }
    input[type="text"] { padding: 5px; width: 100%; margin-top: 10px; }
    button { margin-top: 10px; padding: 8px 12px; font-size: 16px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸŸï¸ Pase ID: {{ pase.id }}</h2>
    <p><strong>Rol:</strong> {{ pase.rol }}</p>
    <p><strong>Fecha autorizada:</strong> {{ pase.fecha }}</p>
    <ul>
      <li>ğŸ“„ DocumentaciÃ³n: {{ 'âœ…' if pase.documentacion else 'âŒ' }}</li>
      <li>ğŸ§¯ Curso: {{ 'âœ…' if pase.curso else 'âŒ' }}</li>
      <li>ğŸŒ± Certificado: {{ 'âœ…' if pase.certificado else 'âŒ' }}</li>
      <li>ğŸ” AutorizaciÃ³n: {{ 'âœ…' if pase.autorizacion else 'âŒ' }}</li>
      <li>ğŸ“† Cita: {{ 'âœ…' if pase.cita else 'âŒ' }}</li>
    </ul>

    <div id="nombre-block">
      {% if pase.nombre %}
        <p><strong>ğŸ™‹ Nombre:</strong> {{ pase.nombre }}</p>
      {% else %}
        <input type="text" id="nombre" placeholder="IngresÃ¡ tu nombre y apellido">
        <button onclick="guardarNombre()">Guardar nombre</button>
      {% endif %}
    </div>

    <div id="estado">âŒ› Esperando la revelaciÃ³n...</div>
  </div>

  <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
  <script>
    const socket = io();
    socket.on('resultado', (data) => {
      if (data.id === "{{ pase.id }}") {
        const estadoDiv = document.getElementById('estado');
        if (data.es_impostor) {
          estadoDiv.textContent = "ğŸš¨ Sos un impostor. No podÃ©s ingresar.";
          estadoDiv.style.color = "red";
        } else if (data.puede_ingresar) {
          estadoDiv.textContent = "âœ… EstÃ¡s autorizado a ingresar.";
          estadoDiv.style.color = "green";
        } else {
          estadoDiv.textContent = "âŒ No cumplÃ­s los requisitos.";
          estadoDiv.style.color = "orange";
        }
      }
    });

    function guardarNombre() {
      const nombre = document.getElementById("nombre").value;
      fetch("/guardar_nombre", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `id={{ pase.id }}&nombre=${encodeURIComponent(nombre)}`
      }).then(res => {
        if (res.ok) {
          document.getElementById("nombre-block").innerHTML = `<p><strong>ğŸ™‹ Nombre:</strong> ${nombre}</p>`;
        }
      });
    }
  </script>
</body>
</html>
