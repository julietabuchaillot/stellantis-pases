<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Revelar Resultado</title>
  <style>
    body { font-family: Helvetica, sans-serif; padding: 20px; }
    #resultados { margin-top: 20px; }
    ul { list-style: none; padding: 0; }
    li { margin-bottom: 5px; }
    button { margin-right: 10px; margin-top: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>üîç Resultado en tiempo real</h1>
  <button onclick="disparar()">Revelar resultados</button>
  <button onclick="mostrarNoIngresaron()">Mostrar no admitidos</button>
  <button onclick="mostrarImpostores()">Mostrar impostores</button>

  <div id="resultados"></div>

  <script>
    let todos = [];

    async function disparar(){
      const res = await fetch('/disparar_revelacion');
      alert(await res.text());
      todos = await fetch('/obtener_pases').then(r => r.json());

      const aceptados = todos.filter(p =>
        !p.es_impostor &&
        p.fecha === "2025-06-26 15:00" &&
        p.documentacion && p.curso && p.certificado && p.autorizacion && p.cita
      );

      document.getElementById("resultados").innerHTML = `
        <h2>üìä Resultados generales</h2>
        <ul>
          <li>‚úÖ Aceptados: ${aceptados.length}</li>
          <li>üö® Impostores: ${todos.filter(p => p.es_impostor).length}</li>
          <li>‚ùå No admitidos: ${todos.length - aceptados.length - todos.filter(p => p.es_impostor).length}</li>
        </ul>`;
    }

    function mostrarNoIngresaron(){
      const noAdmitidos = todos.filter(p =>
        !p.es_impostor && (
          p.fecha !== "2025-06-26 15:00" ||
          !p.documentacion || !p.curso || !p.certificado || !p.autorizacion || !p.cita
        )
      );

      const clasificados = {
        "documentaci√≥n": [],
        "curso": [],
        "certificado": [],
        "autorizaci√≥n": [],
        "cita": []
      };

      noAdmitidos.forEach(p => {
        const nombre = p.nombre || `ID ${p.id}`;
        if (!p.documentacion) clasificados["documentaci√≥n"].push(nombre);
        if (!p.curso) clasificados["curso"].push(nombre);
        if (!p.certificado) clasificados["certificado"].push(nombre);
        if (!p.autorizacion) clasificados["autorizaci√≥n"].push(nombre);
        if (!p.cita) clasificados["cita"].push(nombre);
      });

      let html = `<h2>‚ùå No pudieron ingresar</h2>`;
      for (let motivo in clasificados) {
        html += `<h3>Por falta de ${motivo}:</h3><ul>`;
        clasificados[motivo].forEach(n => html += `<li>${n}</li>`);
        html += `</ul>`;
      }
      document.getElementById("resultados").innerHTML = html;
    }

    function mostrarImpostores(){
      const impostores = todos.filter(p => p.es_impostor);
      let html = `<h2>üö® Impostores</h2><ul>`;
      impostores.forEach(p => {
        html += `<li>${p.nombre || `ID ${p.id}`}</li>`;
      });
      html += `</ul>`;
      document.getElementById("resultados").innerHTML = html;
    }
  </script>
</body>
</html>
